[
  {
    "path": "index.tsx",
    "content": "\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\n\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n  throw new Error(\"Could not find root element to mount to\");\n}\n\nconst root = ReactDOM.createRoot(rootElement);\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);"
  },
  {
    "path": "metadata.json",
    "content": "\n{\n  \"name\": \"LIDIA\",\n  \"description\": \"An application for registered users to generate a limited number of professionally formatted digital books (PDF and DOCX) using AI. New user access requires manual activation by an administrator.\",\n  \"requestFramePermissions\": []\n}"
  },
  {
    "path": "index.html",
    "content": "\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <link rel=\"icon\" type=\"image/png\" href=\"/favicon.png\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Lidia - AI Book Maker</title>\n\n    <!-- Pre-load script to clear corrupted sessions -->\n    <script>\n      try {\n        const urlParams = new URLSearchParams(window.location.search);\n        if (urlParams.get('force_logout') === 'true') {\n          console.log('Force logout: Running pre-load cleanup. NO REDIRECT.');\n          const supabaseKeyPattern = /^sb-.*-auth-token$/;\n          for (let i = localStorage.length - 1; i >= 0; i--) {\n            const key = localStorage.key(i);\n            if (key && supabaseKeyPattern.test(key)) {\n              localStorage.removeItem(key);\n              console.log('Force logout: Removed Supabase key:', key);\n            }\n          }\n          // By NOT redirecting, we allow the newly loaded JS bundle to handle routing\n          // on a clean slate. We just remove the param from history.\n          window.history.replaceState(null, '', window.location.pathname);\n          console.log('Force logout: Cleanup complete. URL cleaned.');\n        }\n      } catch (e) {\n        console.error('Error in pre-load cleanup script:', e);\n      }\n    </script>\n    \n    <link rel=\"stylesheet\" href=\"/index.css\" />\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=League+Gothic&family=Merriweather:wght@300;400;700;900&family=Merriweather+Sans:wght@300;400;600;700&display=swap\" rel=\"stylesheet\">\n    <style>\n      body {\n        font-family: 'Merriweather Sans', sans-serif;\n      }\n      .font-league-gothic {\n        font-family: 'League Gothic', sans-serif;\n      }\n      .font-merriweather {\n        font-family: 'Merriweather', serif;\n      }\n    </style>\n  <script type=\"importmap\">\n{\n  \"imports\": {\n    \"react\": \"https://esm.sh/react@18.3.1\",\n    \"react-dom\": \"https://esm.sh/react-dom@18.3.1\",\n    \"react-dom/client\": \"https://esm.sh/react-dom@18.3.1/client\",\n    \"@google/genai\": \"https://esm.sh/@google/genai@1.26.0\",\n    \"@supabase/supabase-js\": \"https://esm.sh/@supabase/supabase-js@2.44.4\",\n    \"jspdf\": \"https://esm.sh/jspdf@2.5.1\",\n    \"html2canvas\": \"https://esm.sh/html2canvas@1.4.1\",\n    \"html2pdf.js\": \"https://esm.sh/html2pdf.js@0.10.1\",\n    \"pdf-lib\": \"https://esm.sh/pdf-lib@1.17.1\",\n    \"docx\": \"https://esm.sh/docx@8.5.0\",\n    \"react-dom/\": \"https://aistudiocdn.com/react-dom@^18.3.1/\",\n    \"react/\": \"https://aistudiocdn.com/react@^18.3.1/\",\n    \"deno.ns\": \"https://aistudiocdn.com/deno.ns@^0.8.0\"\n  }\n}\n</script>\n</head>\n  <body class=\"bg-gray-100\">\n    <div id=\"root\"></div>\n    <script type=\"module\" src=\"/index.tsx\"></script>\n  </body>\n</html>"
  },
  {
    "path": "types.ts",
    "content": "\n\n\n\nexport type UserStatus = 'ativa_pro' | 'ativa_free' | 'suspensa' | 'aguardando_ativacao' | 'ativa_starter' | 'ativa_premium';\nexport type UserRole = 'user' | 'admin';\nexport type Page = 'landing' | 'login' | 'suspended-account' | 'dashboard' | 'create-book' | 'admin-users' | 'admin-settings' | 'view-book' | 'admin-activation' | 'loading' | 'awaiting-activation';\n\nexport interface UserProfile {\n  id: string;\n  email?: string; // Email is on the auth.users table, might not be joined\n  status: UserStatus;\n  role: UserRole;\n  book_credits: number;\n}\n\n// FIX: Added 'processing_parts' to the BookStatus type to accommodate all possible book states from the backend and fix type errors in DashboardPage.\nexport type BookStatus = 'generating_content' | 'content_ready' | 'processing_parts' | 'generating_pdf' | 'ready' | 'error';\n\nexport interface Book {\n  id: string;\n  user_id: string;\n  title: string;\n  subtitle: string;\n  author: string;\n  created_at: string;\n  content?: string | null; // This is now legacy or for caching, the source of truth is book_parts\n  status: BookStatus;\n  pdf_final_url?: string | null;\n}\n\nexport interface BookPart {\n    id: string;\n    book_id: string;\n    part_index: number;\n    part_type: string; // e.g., 'cover', 'copyright', 'chapter_title', 'chapter_content'\n    content: string; // Can be simple text from AI or generated HTML\n}\n\n\nexport interface BookGenerationFormData {\n    title: string;\n    subtitle:string;\n    author: string;\n    language: string;\n    tone: string;\n    niche: string;\n    summary: string;\n}\n\nexport interface PlanSetting {\n    plan_id: UserStatus;\n    plan_name: string;\n    book_credits: number;\n}"
  },
  {
    "path": "services/mockData.ts",
    "content": "\n\nimport { UserProfile, Book } from '../types';\n\nexport const mockUsers: UserProfile[] = [\n  {\n    id: '1',\n    email: 'admin@lidia.com',\n    status: 'ativa_pro',\n    role: 'admin',\n    book_credits: 999,\n  },\n  {\n    id: '2',\n    email: 'user@example.com',\n    status: 'ativa_pro',\n    role: 'user',\n    book_credits: 8,\n  },\n  {\n    id: '3',\n    email: 'free@example.com',\n    status: 'ativa_free',\n    role: 'user',\n    book_credits: 1,\n  },\n  {\n    id: '4',\n    email: 'suspended@example.com',\n    status: 'suspensa',\n    role: 'user',\n    book_credits: 0,\n  },\n  {\n    id: '5',\n    email: 'usedfree@example.com',\n    status: 'ativa_free',\n    role: 'user',\n    book_credits: 0,\n  },\n  {\n    id: '6',\n    email: 'pending@example.com',\n    status: 'aguardando_ativacao',\n    role: 'user',\n    book_credits: 0,\n  },\n];\n\nexport const mockBooks: Book[] = [\n  {\n    id: 'b1',\n    // FIX: Changed 'userId' to 'user_id' to match the 'Book' type definition.\n    user_id: '2',\n    title: 'A Jornada do Herói Digital',\n    subtitle: 'Conquistando o impossível no mundo online',\n    author: 'user@example.com',\n    // FIX: Changed 'createdAt' to 'created_at' to match the 'Book' type definition.\n    created_at: new Date(Date.now() - 86400000 * 2).toISOString(),\n    // FIX: Added missing 'status' property to match the 'Book' type.\n    status: 'ready',\n  },\n   {\n    id: 'b2',\n    // FIX: Changed 'userId' to 'user_id' to match the 'Book' type definition.\n    user_id: '2',\n    title: 'Receitas para o Sucesso',\n    subtitle: 'Um guia culinário para empreendedores',\n    author: 'user@example.com',\n    // FIX: Changed 'createdAt' to 'created_at' to match the 'Book' type definition.\n    created_at: new Date(Date.now() - 86400000 * 5).toISOString(),\n    // FIX: Added missing 'status' property to match the 'Book' type.\n    status: 'ready',\n  },\n];"
  },
  {
    "path": "components/ui/Button.tsx",
    "content": "\nimport React from 'react';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  children: React.ReactNode;\n  variant?: 'primary' | 'secondary' | 'danger' | 'success';\n  isLoading?: boolean;\n  loadingText?: string;\n}\n\nexport const Button: React.FC<ButtonProps> = ({ children, className, variant = 'primary', isLoading = false, loadingText, ...props }) => {\n  const baseClasses = \"font-bold py-3 px-6 rounded-lg shadow-lg focus:outline-none focus:ring-2 focus:ring-opacity-75 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100\";\n  \n  const variantClasses = {\n    primary: 'bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500',\n    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400',\n    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',\n    success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500',\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${variantClasses[variant]} ${className || ''}`}\n      disabled={isLoading || props.disabled}\n      {...props}\n    >\n      {isLoading ? (\n        <div className=\"flex items-center justify-center\">\n          <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          {loadingText || 'Processando...'}\n        </div>\n      ) : (\n        children\n      )}\n    </button>\n  );\n};"
  },
  {
    "path": "components/ui/Input.tsx",
    "content": "\n\n\nimport React from 'react';\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n}\n\nexport const Input: React.FC<InputProps> = ({ label, id, ...props }) => {\n  return (\n    <div>\n      <label htmlFor={id} className=\"block text-sm font-medium text-gray-700\">{label}</label>\n      <input\n        id={id}\n        className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n        {...props}\n      />\n    </div>\n  );\n};\n\ninterface TextAreaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  label: string;\n}\n\nexport const TextArea: React.FC<TextAreaProps> = ({ label, id, ...props }) => {\n  return (\n    <div>\n      <label htmlFor={id} className=\"block text-sm font-medium text-gray-700\">{label}</label>\n      <textarea\n        id={id}\n        rows={4}\n        className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n        {...props}\n      />\n    </div>\n  );\n};"
  },
  {
    "path": "components/ui/Card.tsx",
    "content": "\n\n\nimport React from 'react';\n\ninterface CardProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const Card: React.FC<CardProps> = ({ children, className }) => {\n  return (\n    <div className={`bg-white rounded-xl shadow-lg p-6 md:p-8 ${className}`}>\n      {children}\n    </div>\n  );\n};"
  },
  {
    "path": "components/LandingPage.tsx",
    "content": "\nimport React from 'react';\nimport { Button } from './ui/Button';\nimport type { Page } from '../types';\n\ninterface LandingPageProps {\n  onNavigate: (page: 'login') => void;\n  logoUrl: string | null;\n}\n\nexport const LandingPage: React.FC<LandingPageProps> = ({ onNavigate, logoUrl }) => {\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex flex-col justify-center items-center text-center px-4\">\n      <header className=\"absolute top-0 left-0 right-0 p-4 flex justify-between items-center\">\n        <img src={logoUrl || '/logo.png'} alt=\"LIDIA Logo\" className=\"h-10\" />\n        <Button onClick={() => onNavigate('login')} variant=\"secondary\">Login</Button>\n      </header>\n      <main className=\"max-w-4xl mx-auto\">\n        <h2 className=\"text-5xl md:text-7xl font-extrabold text-gray-900 leading-tight\">\n          Transforme Suas Ideias em <span className=\"text-indigo-600\">Livros Digitais</span> Profissionais.\n        </h2>\n        <p className=\"mt-6 text-lg md:text-xl text-gray-600 max-w-2xl mx-auto\">\n          Com o poder da Inteligência Artificial, o Lidia Book Maker cria e-books completos e formatados para você em minutos, não em meses.\n        </p>\n        <div className=\"mt-10\">\n          <Button onClick={() => onNavigate('login')} className=\"text-xl md:text-2xl px-10 py-5\">\n            COMECE GRÁTIS AGORA\n          </Button>\n        </div>\n      </main>\n    </div>\n  );\n};"
  },
  {
    "path": "components/AuthPage.tsx",
    "content": "\nimport React, { useState } from 'react';\nimport { Button } from './ui/Button';\nimport { Input } from './ui/Input';\nimport { Card } from './ui/Card';\nimport { supabase } from '../services/supabase';\n\ninterface AuthPageProps {\n  initialError?: string | null;\n  logoUrl: string | null;\n}\n\nconst GoogleIcon = () => (\n    <svg className=\"w-5 h-5 mr-3\" viewBox=\"0 0 48 48\">\n        <path fill=\"#FFC107\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path>\n        <path fill=\"#FF3D00\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path>\n        <path fill=\"#4CAF50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path>\n        <path fill=\"#1976D2\" d=\"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C42.012,35.24,44,30.038,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\n    </svg>\n);\n\n\nexport const AuthPage: React.FC<AuthPageProps> = ({ initialError, logoUrl }) => {\n  const [isLogin, setIsLogin] = useState(true);\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState(initialError || '');\n  const [message, setMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleAuthAction = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError('');\n    setMessage('');\n\n    try {\n      if (isLogin) {\n        const { error } = await supabase.auth.signInWithPassword({ email, password });\n        if (error) throw error;\n      } else {\n        const { error } = await supabase.auth.signUp({ \n            email, \n            password,\n        });\n        if (error) throw error;\n        setMessage('Verifique seu e-mail para confirmar o cadastro!');\n      }\n    } catch (err) {\n        const authError = err as { message: string };\n        if(authError.message.includes('Invalid login credentials')) {\n            setError('Credenciais inválidas.');\n        } else if (authError.message.includes('User already registered')) {\n            setError('Este e-mail já está cadastrado.');\n        } else {\n            setError(authError.message);\n        }\n    } finally {\n        setIsLoading(false);\n    }\n  };\n\n  const handleGoogleSignIn = async () => {\n    setError('');\n    const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n    });\n    if (error) {\n        setError(error.message);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 flex flex-col justify-center items-center p-4\">\n      <img src={logoUrl || '/logo.png'} alt=\"LIDIA Logo\" className=\"h-12 mb-6\" />\n      <Card className=\"w-full max-w-md\">\n        <h2 className=\"text-2xl font-bold text-center text-gray-800 mb-6\">{isLogin ? 'Bem-vindo de volta!' : 'Crie sua conta'}</h2>\n        \n        <Button onClick={handleGoogleSignIn} className=\"w-full mb-4 flex items-center justify-center\" variant=\"secondary\">\n            <GoogleIcon />\n            {isLogin ? 'Entrar com Google' : 'Cadastrar com Google'}\n        </Button>\n\n        <div className=\"relative my-4\">\n            <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t border-gray-300\"></div>\n            </div>\n            <div className=\"relative flex justify-center text-sm\">\n                <span className=\"px-2 bg-white text-gray-500\">Ou continue com</span>\n            </div>\n        </div>\n\n        {error && <p className=\"text-red-500 text-sm text-center mb-4\">{error}</p>}\n        {message && <p className=\"text-green-600 text-sm text-center mb-4\">{message}</p>}\n\n        <form onSubmit={handleAuthAction} className=\"space-y-4\">\n          <Input id=\"email\" label=\"Email\" type=\"email\" value={email} onChange={e => setEmail(e.target.value)} required />\n          <Input id=\"password\" label=\"Senha\" type=\"password\" value={password} onChange={e => setPassword(e.target.value)} required />\n          <Button type=\"submit\" className=\"w-full\" isLoading={isLoading}>\n            {isLogin ? 'Entrar' : 'Cadastrar'}\n          </Button>\n        </form>\n        <p className=\"mt-6 text-center text-sm\">\n          {isLogin ? 'Não tem uma conta?' : 'Já tem uma conta?'}\n          <button onClick={() => { setIsLogin(!isLogin); setError(''); setMessage(''); }} className=\"font-medium text-indigo-600 hover:text-indigo-500 ml-1\">\n            {isLogin ? 'Cadastre-se' : 'Faça login'}\n          </button>\n        </p>\n      </Card>\n    </div>\n  );\n};"
  }
]
